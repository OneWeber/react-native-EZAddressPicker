{"version":3,"sources":["../../../src/commands/init/template.ts"],"names":["installTemplatePackage","templateName","root","npm","logger","debug","PackageManager","install","preferYarn","silent","getTemplateConfig","templateSourceDir","configFilePath","path","resolve","fs","existsSync","CLIError","chalk","underline","dim","require","copyTemplate","templateDir","templatePath","regexStr","process","cwd","exclude","RegExp","executePostInitScript","postInitScript","scriptPath","stdio"],"mappings":";;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;;AACA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AASO,SAASA,sBAAT,CACLC,YADK,EAELC,IAFK,EAGLC,GAHK,EAIL;AACAC,qBAAOC,KAAP,CAAc,4BAA2BJ,YAAa,EAAtD;;AACA,SAAOK,cAAc,CAACC,OAAf,CAAuB,CAACN,YAAD,CAAvB,EAAuC;AAC5CO,IAAAA,UAAU,EAAE,CAACL,GAD+B;AAE5CM,IAAAA,MAAM,EAAE,IAFoC;AAG5CP,IAAAA;AAH4C,GAAvC,CAAP;AAKD;;AAEM,SAASQ,iBAAT,CACLT,YADK,EAELU,iBAFK,EAGW;AAChB,QAAMC,cAAc,GAAGC,gBAAKC,OAAL,CACrBH,iBADqB,EAErB,cAFqB,EAGrBV,YAHqB,EAIrB,oBAJqB,CAAvB;;AAOAG,qBAAOC,KAAP,CAAc,uBAAsBO,cAAe,EAAnD;;AACA,MAAI,CAACG,cAAGC,UAAH,CAAcJ,cAAd,CAAL,EAAoC;AAClC,UAAM,KAAIK,oBAAJ,EACH,sBAAqBL,cAAe,iBAAgBX,YAAa;mBACrDiB,iBAAMC,SAAN,CAAgBC,GAAhB,CACX,iGADW,CAEX,EAJE,CAAN;AAMD;;AACD,SAAOC,OAAO,CAACT,cAAD,CAAd;AACD;;AAEM,eAAeU,YAAf,CACLrB,YADK,EAELsB,WAFK,EAGLZ,iBAHK,EAIL;AACA,QAAMa,YAAY,GAAGX,gBAAKC,OAAL,CACnBH,iBADmB,EAEnB,cAFmB,EAGnBV,YAHmB,EAInBsB,WAJmB,CAArB;;AAOAnB,qBAAOC,KAAP,CAAc,yBAAwBmB,YAAa,EAAnD;;AACA,MAAIC,QAAQ,GAAGZ,gBAAKC,OAAL,CAAaU,YAAb,EAA2B,cAA3B,CAAf;;AACA,QAAM,wBAAUA,YAAV,EAAwBE,OAAO,CAACC,GAAR,EAAxB,EAAuC;AAC3CC,IAAAA,OAAO,EAAE,CAAC,IAAIC,MAAJ,CAAW,qCAAuBJ,QAAvB,CAAX,CAAD;AADkC,GAAvC,CAAN;AAGD;;AAEM,SAASK,qBAAT,CACL7B,YADK,EAEL8B,cAFK,EAGLpB,iBAHK,EAIL;AACA,QAAMqB,UAAU,GAAGnB,gBAAKC,OAAL,CACjBH,iBADiB,EAEjB,cAFiB,EAGjBV,YAHiB,EAIjB8B,cAJiB,CAAnB;;AAOA3B,qBAAOC,KAAP,CAAc,sCAAqC2B,UAAW,EAA9D;;AAEA,SAAO,sBAAMA,UAAN,EAAkB;AAACC,IAAAA,KAAK,EAAE;AAAR,GAAlB,CAAP;AACD","sourcesContent":["import execa from 'execa';\nimport path from 'path';\nimport {logger, CLIError} from '@react-native-community/cli-tools';\nimport * as PackageManager from '../../tools/packageManager';\nimport copyFiles from '../../tools/copyFiles';\nimport replacePathSepForRegex from '../../tools/replacePathSepForRegex';\nimport fs from 'fs';\nimport chalk from 'chalk';\n\nexport type TemplateConfig = {\n  placeholderName: string;\n  templateDir: string;\n  postInitScript?: string;\n  titlePlaceholder?: string;\n};\n\nexport function installTemplatePackage(\n  templateName: string,\n  root: string,\n  npm?: boolean,\n) {\n  logger.debug(`Installing template from ${templateName}`);\n  return PackageManager.install([templateName], {\n    preferYarn: !npm,\n    silent: true,\n    root,\n  });\n}\n\nexport function getTemplateConfig(\n  templateName: string,\n  templateSourceDir: string,\n): TemplateConfig {\n  const configFilePath = path.resolve(\n    templateSourceDir,\n    'node_modules',\n    templateName,\n    'template.config.js',\n  );\n\n  logger.debug(`Getting config from ${configFilePath}`);\n  if (!fs.existsSync(configFilePath)) {\n    throw new CLIError(\n      `Couldn't find the \"${configFilePath} file inside \"${templateName}\" template. Please make sure the template is valid.\n      Read more: ${chalk.underline.dim(\n        'https://github.com/react-native-community/cli/blob/master/docs/init.md#creating-custom-template',\n      )}`,\n    );\n  }\n  return require(configFilePath);\n}\n\nexport async function copyTemplate(\n  templateName: string,\n  templateDir: string,\n  templateSourceDir: string,\n) {\n  const templatePath = path.resolve(\n    templateSourceDir,\n    'node_modules',\n    templateName,\n    templateDir,\n  );\n\n  logger.debug(`Copying template from ${templatePath}`);\n  let regexStr = path.resolve(templatePath, 'node_modules');\n  await copyFiles(templatePath, process.cwd(), {\n    exclude: [new RegExp(replacePathSepForRegex(regexStr))],\n  });\n}\n\nexport function executePostInitScript(\n  templateName: string,\n  postInitScript: string,\n  templateSourceDir: string,\n) {\n  const scriptPath = path.resolve(\n    templateSourceDir,\n    'node_modules',\n    templateName,\n    postInitScript,\n  );\n\n  logger.debug(`Executing post init script located ${scriptPath}`);\n\n  return execa(scriptPath, {stdio: 'inherit'});\n}\n"]}